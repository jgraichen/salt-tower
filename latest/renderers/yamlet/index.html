
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-7.3.4">
    
    
      
        <title>Yamlet - Salt Tower</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.db9e7362.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
      <script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#yamlet" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Salt Tower" class="md-header__button md-logo" aria-label="Salt Tower" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Salt Tower
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Yamlet
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 9a3 3 0 0 1 3 3 3 3 0 0 1-3 3 3 3 0 0 1-3-3 3 3 0 0 1 3-3m0-4.5c5 0 9.27 3.11 11 7.5-1.73 4.39-6 7.5-11 7.5S2.73 16.39 1 12c1.73-4.39 6-7.5 11-7.5M3.18 12a9.821 9.821 0 0 0 17.64 0 9.821 9.821 0 0 0-17.64 0z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0 8a5 5 0 0 1-5-5 5 5 0 0 1 5-5 5 5 0 0 1 5 5 5 5 0 0 1-5 5m0-12.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/jgraichen/salt-tower/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    jgraichen/salt-tower
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Salt Tower" class="md-nav__button md-logo" aria-label="Salt Tower" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Salt Tower
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/jgraichen/salt-tower/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    jgraichen/salt-tower
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Welcome
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/" class="md-nav__link">
        Configuration
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../tower/" class="md-nav__link">
        Tower File
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../pillar/" class="md-nav__link">
        Pillar Data Files
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Renderers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Renderers" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Renderers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../filter/" class="md-nav__link">
        Filter
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../text/" class="md-nav__link">
        Text
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Yamlet
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Yamlet
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#yaml" class="md-nav__link">
    YAML
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    Examples
  </a>
  
    <nav class="md-nav" aria-label="Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#include-a-template-file" class="md-nav__link">
    Include a template file
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-template-context" class="md-nav__link">
    Custom template context
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#include-a-data-file" class="md-nav__link">
    Include a data file
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#include-a-binary-file" class="md-nav__link">
    Include a binary file
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tag-details" class="md-nav__link">
    Tag details
  </a>
  
    <nav class="md-nav" aria-label="Tag details">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#include" class="md-nav__link">
    include
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#read" class="md-nav__link">
    read
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#yaml" class="md-nav__link">
    YAML
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    Examples
  </a>
  
    <nav class="md-nav" aria-label="Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#include-a-template-file" class="md-nav__link">
    Include a template file
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-template-context" class="md-nav__link">
    Custom template context
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#include-a-data-file" class="md-nav__link">
    Include a data file
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#include-a-binary-file" class="md-nav__link">
    Include a binary file
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tag-details" class="md-nav__link">
    Tag details
  </a>
  
    <nav class="md-nav" aria-label="Tag details">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#include" class="md-nav__link">
    include
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#read" class="md-nav__link">
    read
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/jgraichen/salt-tower/edit/main/docs/renderers/yamlet.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="yamlet">Yamlet<a class="headerlink" href="#yamlet" title="Permanent link">&para;</a></h1>
<p>The Yamlet renderer parses YAML and handles additional tags to work with files and blobs.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>salt-tower will default to use <code>jinja|yamlet</code> as the default renderer stack if the <code>yamlet</code> renderer is installed. You do <em>not</em> need to explicit set the renderer e.g. with <code>#!yamlet</code> to use its features in tower data files.</p>
</div>
<h2 id="yaml">YAML<a class="headerlink" href="#yaml" title="Permanent link">&para;</a></h2>
<p>The Yamlet renderer parses a text file as YAML and returns the resulting data structure. The return value of this renderer therefore is a dict, or list, or similar, but not text.</p>
<p>Additional YAML tags are processed to safely load and include files, e.g. text config files or binary files as blobs, without issues with YAML formatting or encoding compared to including them with JINJA.</p>
<dl>
<dt><code>!include</code></dt>
<dd><a href="#include-a-template-file">Include a template file</a> into the YAML data structure, e.g. a web server or application config file.</dd>
<dt><code>!read</code></dt>
<dd><a href="#include-a-binary-file">Directly load and include a file</a> without further processing. Can be a text or a binary file, e.g. a TLS private key or a binary license file.</dd>
</dl>
<p>See the following sections for details.</p>
<h2 id="examples">Examples<a class="headerlink" href="#examples" title="Permanent link">&para;</a></h2>
<h3 id="include-a-template-file">Include a template file<a class="headerlink" href="#include-a-template-file" title="Permanent link">&para;</a></h3>
<p>The Yamlet renderer can include a template file into the pillar, without any formatting issues that might arrive when trying to use JINJA. The renderer will parse the YAML and directly render the template into the pillar, not the other way around.</p>
<p>Assume we have an <code>nginx</code> state that expects a list of site configuration files as string blobs:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># role/webserver/init.sls</span>

<span class="nt">nginx</span><span class="p">:</span>
  <span class="nt">site</span><span class="p">:</span>
    <span class="nt">default</span><span class="p">:</span> <span class="kt">!include</span> <span class="l l-Scalar l-Scalar-Plain">files/nginx.default.j2</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="x">#!jinja|text</span>
<span class="x"># role/webserver/files/nginx.default.j2</span>
<span class="x"># We want this file to be rendered using JINJA first, and into</span>
<span class="x"># a text string second, to be included as a string in the pillar.</span>

<span class="x">server {</span>
<span class="x">    listen 80 default_server;</span>
<span class="x">    listen [::]:80 default_server;</span>

<span class="x">    listen  443 ssl http2 default_server;</span>
<span class="x">    listen  [::]:443 ssl http2 default_server;</span>

<span class="x">    server_name </span><span class="cp">{{</span> <span class="nv">grains</span><span class="o">[</span><span class="s1">&#39;localhost&#39;</span><span class="o">]</span> <span class="cp">}}</span><span class="x">;</span>
<span class="x">    include snippets/snakeoil.conf;</span>

<span class="x">    root /var/www/html;</span>

<span class="x">    location / {</span>
<span class="x">        # First attempt to serve request as file, then</span>
<span class="x">        # as directory, then fall back to displaying a 404.</span>
<span class="x">        try_files $uri $uri/ =404;</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>
<p>The <code>!include</code> tag will render the file using the default salt renderers. You can therefore use JINJA or any other renderers. It is recommended to specify the renderers using a shebang as shown above:</p>
<div class="highlight"><pre><span></span><code>#!jinja|text
</code></pre></div>
<p>This will first render the file using the JINJA, replacing e.g. <code class="highlight"><span class="cp">{{</span> <span class="nv">grains</span><span class="o">[</span><span class="s1">&#39;localhost&#39;</span><span class="o">]</span> <span class="cp">}}</span><span class="x"></span></code>, and return the result as a text to the yamlet renderer.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Read more about salts rendering pipeline and how to combine renderers in the <a href="https://docs.saltproject.io/en/master/ref/renderers/index.html">official documentation</a>.</p>
</div>
<p>The result will look like this, but there will be no issue with indention, encoding, formatting or anything else:</p>
<div class="highlight"><pre><span></span><code><span class="nt">nginx</span><span class="p">:</span>
  <span class="nt">site</span><span class="p">:</span>
    <span class="nt">default</span><span class="p">:</span> <span class="p p-Indicator">|</span>
      <span class="no"># role/webserver/files/nginx.default.j2</span>
      <span class="no"># We want this file to be rendered using JINJA first, and into</span>
      <span class="no"># a text string second, to be included as a string in the pillar.</span>

      <span class="no">server {</span>
          <span class="no">listen 80 default_server;</span>
          <span class="no">listen [::]:80 default_server;</span>

          <span class="no">listen  443 ssl http2 default_server;</span>
          <span class="no">listen  [::]:443 ssl http2 default_server;</span>

          <span class="no">server_name server-hostname-here;</span>
          <span class="no">include snippets/snakeoil.conf;</span>

          <span class="no">root /var/www/html;</span>

          <span class="no">location / {</span>
              <span class="no"># First attempt to serve request as file, then</span>
              <span class="no"># as directory, then fall back to displaying a 404.</span>
              <span class="no">try_files $uri $uri/ =404;</span>
          <span class="no">}</span>
      <span class="no">}</span>
</code></pre></div>
<p>This can greatly simplify writing states, as is much easier to just ship full configuration files or snippets.</p>
<h3 id="custom-template-context">Custom template context<a class="headerlink" href="#custom-template-context" title="Permanent link">&para;</a></h3>
<p>The longer mapping variant of the <code>!include</code> tag allows passing custom context data to the renderers. This can be used to expand e.g. a shared configuration file snippet with some custom values:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># role/webserver/init.sls</span>

<span class="nt">nginx</span><span class="p">:</span>
  <span class="nt">site</span><span class="p">:</span>
    <span class="nt">app1</span><span class="p">:</span> <span class="kt">!include</span>
      <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">files/nginx.app.j2</span>
      <span class="nt">context</span><span class="p">:</span>
        <span class="nt">server_name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">app1.com</span>
        <span class="nt">directory</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">sites/app1</span>

    <span class="nt">app2</span><span class="p">:</span> <span class="kt">!include</span>
      <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">files/nginx.app.j2</span>
      <span class="nt">context</span><span class="p">:</span>
        <span class="nt">server_name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">app2.com</span>
        <span class="nt">directory</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">app2/public</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="x">#!jinja|text</span>
<span class="x"># role/webserver/files/nginx.app.j2</span>

<span class="x">server {</span>
<span class="x">    listen 80 default_server;</span>
<span class="x">    listen [::]:80 default_server;</span>

<span class="x">    server_name </span><span class="cp">{{</span> <span class="nv">server_name</span> <span class="cp">}}</span><span class="x">;</span>

<span class="x">    root /var/www/</span><span class="cp">{{</span> <span class="nv">directory</span> <span class="cp">}}</span><span class="x">;</span>

<span class="x">    location / {</span>
<span class="x">        # First attempt to serve request as file, then</span>
<span class="x">        # as directory, then fall back to displaying a 404.</span>
<span class="x">        try_files $uri $uri/ =404;</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>
<h3 id="include-a-data-file">Include a data file<a class="headerlink" href="#include-a-data-file" title="Permanent link">&para;</a></h3>
<p>The result of a template file doesn't have to a string, it can be data too. You can e.g. include one YAML file into multiple pillar files, or combine that with the <a href="../filter/">filter renderer</a>, to include data from a shared set.</p>
<p>The following example shows to include a shared YAML dataset into multiple places, without any parsing or indention errors, as can happen when using the JINJA <code>include</code> directive:</p>
<div class="highlight"><pre><span></span><code><span class="c1">#!yaml</span>
<span class="c1"># Shared data set (dataset.yaml)</span>

<span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># A pillar data file</span>
<span class="nt">application_1</span><span class="p">:</span>
  <span class="nt">config</span><span class="p">:</span> <span class="kt">!include</span> <span class="l l-Scalar l-Scalar-Plain">../dataset.yaml</span>

<span class="nt">application_2</span><span class="p">:</span>
  <span class="nt">config</span><span class="p">:</span> <span class="kt">!include</span> <span class="l l-Scalar l-Scalar-Plain">../dataset.yaml</span>
</code></pre></div>
<p>The result will have the data set loaded and included for both application keys:</p>
<div class="highlight"><pre><span></span><code><span class="nt">application_1</span><span class="p">:</span>
  <span class="nt">config</span><span class="p">:</span>
    <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>

<span class="nt">application_2</span><span class="p">:</span>
  <span class="nt">config</span><span class="p">:</span>
    <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
</code></pre></div>
<h3 id="include-a-binary-file">Include a binary file<a class="headerlink" href="#include-a-binary-file" title="Permanent link">&para;</a></h3>
<p>The <code>!read</code> YAML tag can safely load text or binary files and include them as blobs in the result.</p>
<div class="highlight"><pre><span></span><code><span class="nt">application</span><span class="p">:</span>
  <span class="nt">license_file</span><span class="p">:</span> <span class="kt">!read</span> <span class="l l-Scalar l-Scalar-Plain">files/license.bin</span>
</code></pre></div>
<p>The <code>license.bin</code> file can be any kind of file, even a binary file. The Yamlet renderer will load the file <em>after</em> it has parsed the YAML and safely embed the binary file content into the data result.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The resulting data structure will include file content as binary string, not a Unicode string as everything else, e.g.:</p>
<div class="highlight"><pre><span></span><code><span class="n">pillar</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;jd</span><span class="se">\x81\xed\xa2</span><span class="s2">~*</span><span class="se">\xca</span><span class="s2">6</span><span class="se">\xd8</span><span class="s2">8,</span><span class="se">\x15</span><span class="s2">zr</span><span class="se">\xb6</span><span class="s2">&quot;</span>
</code></pre></div>
<p>Salt internal and most states (e.g. <code>file.managed</code>) should have not problem with that, but custom code might need adjustments if it e.g. processes the content and did not expect a binary string.</p>
</div>
<h2 id="tag-details">Tag details<a class="headerlink" href="#tag-details" title="Permanent link">&para;</a></h2>
<h3 id="include">include<a class="headerlink" href="#include" title="Permanent link">&para;</a></h3>
<p>The <code>!include</code> tag can be used the short variant, to include a template file using the default renderers:</p>
<div class="highlight"><pre><span></span><code><span class="nt">key</span><span class="p">:</span> <span class="kt">!include</span> <span class="l l-Scalar l-Scalar-Plain">path/to/template</span>
</code></pre></div>
<p>The tag also takes a mapping, which allows specifying more options:</p>
<div class="highlight"><pre><span></span><code><span class="nt">key</span><span class="p">:</span> <span class="kt">!include</span>
  <span class="c1"># Path to template file</span>
  <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">path/to/template</span>

  <span class="c1"># Default renderers if not shebang is specified in template file</span>
  <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">jinja|yamlet</span>

  <span class="c1"># Additional context passed to renderers</span>
  <span class="nt">context</span><span class="p">:</span>
    <span class="nt">some_data</span><span class="p">:</span>
      <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
</code></pre></div>
<h3 id="read">read<a class="headerlink" href="#read" title="Permanent link">&para;</a></h3>
<p>The <code>!read</code> only supports the show variant and as no options:</p>
<div class="highlight"><pre><span></span><code><span class="nt">key</span><span class="p">:</span> <span class="kt">!read</span> <span class="l l-Scalar l-Scalar-Plain">path/to/file</span>
</code></pre></div>
<p>See <a href="https://github.com/jgraichen/salt-tower/blob/main/test/renderers/test_yamlet.py"><code>test/renderers/test_yamlet.py</code></a> for more examples and detailed behavior.</p>
                
                  
                    

<hr>
<div class="md-source-date">
  <small>
    
      Last update: 2021-10-25
    
  </small>
</div>
                  
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../text/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Text" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Text
            </div>
          </div>
        </a>
      
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
            Material for MkDocs
          </a>
        
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.expand", "navigation.instant", "navigation.sections", "search.suggest", "search.highlight"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.8397ff9e.min.js", "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.1e84347e.min.js"></script>
      
    
  </body>
</html>